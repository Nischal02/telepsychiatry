{% extends "dashboard.html" %}
{% load static %}
{% block start %}
<div class="loading text-center">
    <p>Loading...</p>
</div>

<div class="container-fluid" role="main">
    <div class="row">
        <div class="col-4 mt-5 ml-4">
            <img class="profile" src="{% static 'members/images/profile.png' %}" alt="Profile Image"> 
        </div>
        
        <div class="col-5 mt-5 p-3">
            <h1>{{request.user.first_name}} {{request.user.last_name}}</h1>
            <p><strong>Address:</strong> <span id="address">{{ request.user.profile.address }}</span></p>
            <p><strong>Email:</strong> <span id="email">{{ request.user.email }}</span></p>
            <p><strong>Phone Number:</strong> <span id="phone">{{ request.user.profile.phone }}</span></p>
            <a href="/Editprofile"><button class="btn btn-outline-secondary">Edit Profile</button></a>
        </div>
    </div>

    <div class="row mt-5 ml-4">
        <div class="col-5">
            <h1>Past Analysis</h1>
            <table class="table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Analysis Type</th>
                        <th>Result</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2024-01-20</td>
                        <td>Mental health</td>
                        <td>Positive</td>
                    </tr>
                    <tr>
                        <td>2024-01-20</td>
                        <td>Mental health</td>
                        <td>Positive</td>
                    </tr>
                    <tr>
                        <td>2024-01-20</td>
                        <td>Mental health</td>
                        <td>Positive</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="col-5">
            <h1>Appointments</h1>
            <table class="table">
                <thead>
                    <tr>
                        <th>Date and time</th>
                        <th>Doctor Name</th>
                        <th>Contact Number</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2024-01-20  2:30 pm</td>
                        <td>Harry </td>
                        <td>98563214578</td>
                    </tr>
                    <tr>
                        <td>2024-01-20  4:30 pm</td>
                        <td>Kishor </td>
                        <td>98563214578</td>
                    </tr>
                    <tr>
                        <td>2024-01-20  2:30 pm</td>
                        <td>padma</td>
                        <td>98563214578</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Place JS files at the bottom -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var loadingDiv = document.querySelector('.loading');
        loadingDiv.style.display = 'none';
    });

    // Add event listener for the edit button
    document.getElementById('editButton').addEventListener('click', function () {
        document.getElementById('editProfileForm').style.display = 'block';
        this.style.display = 'none';
    });

    // Add event listener for the edit profile form submission
    document.getElementById('editProfileForm').addEventListener('submit', function (event) {
        event.preventDefault();

        var address = document.getElementById('inputAddress').value;
        var email = document.getElementById('inputEmail').value;
        var phone = document.getElementById('inputPhone').value;

        fetch('/update-profile', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                address: address,
                email: email,
                phone: phone
            })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('address').textContent = address;
            document.getElementById('email').textContent = email;
            document.getElementById('phone').textContent = phone;

            document.getElementById('editProfileForm').style.display = 'none';
            document.getElementById('editButton').style.display = 'block';

            alert('Profile updated successfully!');
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to update profile.');
        });
    });
</script>

{% endblock %}
